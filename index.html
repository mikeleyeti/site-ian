<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionnaire de Contacts Professionnel</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Poppins', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .contact-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .contact-card:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Service GitHub pour gérer les Gists
        class GitHubService {
            constructor() {
                this.baseURL = 'https://api.github.com';
                this.token = null;
                this.username = null;
            }

            setCredentials(token, username) {
                this.token = token;
                this.username = username;
                localStorage.setItem('github_token', token);
                localStorage.setItem('github_username', username);
            }

            getStoredCredentials() {
                return {
                    token: localStorage.getItem('github_token'),
                    username: localStorage.getItem('github_username')
                };
            }

            clearCredentials() {
                this.token = null;
                this.username = null;
                localStorage.removeItem('github_token');
                localStorage.removeItem('github_username');
                localStorage.removeItem('main_gist_id');
            }

            async verifyToken(token) {
                try {
                    const response = await fetch(`${this.baseURL}/user`, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (response.ok) {
                        const user = await response.json();
                        return { valid: true, username: user.login, user };
                    }
                    return { valid: false };
                } catch (error) {
                    console.error('Token verification error:', error);
                    return { valid: false };
                }
            }

            async createGist(data, description = 'Contact Manager Data', isPublic = false) {
                if (!this.token) throw new Error('No token configured');

                const response = await fetch(`${this.baseURL}/gists`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${this.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        description,
                        public: isPublic,
                        files: {
                            'contacts.json': {
                                content: JSON.stringify(data, null, 2)
                            }
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to create gist');
                }

                return await response.json();
            }

            async updateGist(gistId, data, description) {
                if (!this.token) throw new Error('No token configured');

                const response = await fetch(`${this.baseURL}/gists/${gistId}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `token ${this.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        description: description || 'Contact Manager Data - Updated',
                        files: {
                            'contacts.json': {
                                content: JSON.stringify(data, null, 2)
                            }
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to update gist');
                }

                return await response.json();
            }

            async getGist(gistId) {
                const headers = {
                    'Accept': 'application/vnd.github.v3+json'
                };

                if (this.token) {
                    headers['Authorization'] = `token ${this.token}`;
                }

                const response = await fetch(`${this.baseURL}/gists/${gistId}`, {
                    headers
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch gist');
                }

                const gist = await response.json();
                const content = gist.files['contacts.json']?.content;
                
                if (content) {
                    return JSON.parse(content);
                }
                
                return null;
            }

            async listGists() {
                if (!this.token || !this.username) return [];

                const response = await fetch(`${this.baseURL}/users/${this.username}/gists`, {
                    headers: {
                        'Authorization': `token ${this.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (!response.ok) return [];

                const gists = await response.json();
                return gists.filter(g => 
                    g.files['contacts.json'] && 
                    g.description?.includes('Contact Manager')
                );
            }
        }

        const githubService = new GitHubService();

        // Composant principal
        function App() {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [user, setUser] = useState(null);
            const [contacts, setContacts] = useState([]);
            const [mainGistId, setMainGistId] = useState(null);
            const [loading, setLoading] = useState(true);
            const [syncing, setSyncing] = useState(false);
            const [notification, setNotification] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedCategory, setSelectedCategory] = useState('all');

            useEffect(() => {
                checkExistingAuth();
            }, []);

            const checkExistingAuth = async () => {
                const { token, username } = githubService.getStoredCredentials();
                if (token && username) {
                    const result = await githubService.verifyToken(token);
                    if (result.valid) {
                        githubService.setCredentials(token, username);
                        setIsAuthenticated(true);
                        setUser(result.user);
                        await loadMainGist();
                    } else {
                        githubService.clearCredentials();
                    }
                }
                setLoading(false);
            };

            const loadMainGist = async () => {
                setLoading(true);
                try {
                    const storedGistId = localStorage.getItem('main_gist_id');
                    if (storedGistId) {
                        const data = await githubService.getGist(storedGistId);
                        if (data) {
                            setContacts(data.contacts || []);
                            setMainGistId(storedGistId);
                        }
                    } else {
                        const gists = await githubService.listGists();
                        const mainGist = gists.find(g => g.description?.includes('[MAIN]'));
                        
                        if (mainGist) {
                            const data = await githubService.getGist(mainGist.id);
                            setContacts(data.contacts || []);
                            setMainGistId(mainGist.id);
                            localStorage.setItem('main_gist_id', mainGist.id);
                        }
                    }
                } catch (error) {
                    console.error('Error loading gist:', error);
                    showNotification('Erreur lors du chargement des données', 'error');
                } finally {
                    setLoading(false);
                }
            };

            const syncToGitHub = async () => {
                if (!isAuthenticated) return;
                
                setSyncing(true);
                try {
                    const data = {
                        contacts,
                        lastUpdated: new Date().toISOString(),
                        owner: user.login
                    };

                    if (mainGistId) {
                        await githubService.updateGist(
                            mainGistId,
                            data,
                            `[MAIN] Contact Manager Data - ${user.login}`
                        );
                    } else {
                        const gist = await githubService.createGist(
                            data,
                            `[MAIN] Contact Manager Data - ${user.login}`,
                            false
                        );
                        setMainGistId(gist.id);
                        localStorage.setItem('main_gist_id', gist.id);
                    }
                    
                    showNotification('Synchronisé avec GitHub!');
                } catch (error) {
                    console.error('Sync error:', error);
                    showNotification('Erreur de synchronisation', 'error');
                } finally {
                    setSyncing(false);
                }
            };

            const showNotification = (message, type = 'success') => {
                setNotification({ message, type });
                setTimeout(() => setNotification(null), 3000);
            };

            const handleLogin = async (token) => {
                setLoading(true);
                const result = await githubService.verifyToken(token);
                
                if (result.valid) {
                    githubService.setCredentials(token, result.username);
                    setIsAuthenticated(true);
                    setUser(result.user);
                    showNotification('Connexion réussie!');
                    await loadMainGist();
                } else {
                    showNotification('Token invalide', 'error');
                }
                setLoading(false);
            };

            const handleLogout = () => {
                githubService.clearCredentials();
                setIsAuthenticated(false);
                setUser(null);
                setContacts([]);
                setMainGistId(null);
                showNotification('Déconnexion réussie');
            };

            const handleAddContact = (contactData) => {
                const newContact = {
                    ...contactData,
                    id: Date.now(),
                    createdAt: new Date().toISOString()
                };
                const newContacts = [...contacts, newContact];
                setContacts(newContacts);
                syncToGitHub();
                showNotification('Contact ajouté avec succès');
            };

            const handleUpdateContact = (contactId, updates) => {
                const newContacts = contacts.map(c => 
                    c.id === contactId 
                        ? { ...c, ...updates, updatedAt: new Date().toISOString() }
                        : c
                );
                setContacts(newContacts);
                syncToGitHub();
                showNotification('Contact mis à jour');
            };

            const handleDeleteContact = (contactId) => {
                if (confirm('Êtes-vous sûr de vouloir supprimer ce contact?')) {
                    const newContacts = contacts.filter(c => c.id !== contactId);
                    setContacts(newContacts);
                    syncToGitHub();
                    showNotification('Contact supprimé');
                }
            };

            const filteredContacts = contacts.filter(contact => {
                const matchesSearch = searchTerm === '' || 
                    contact.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    contact.email?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    contact.company?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    contact.phone?.includes(searchTerm);
                
                const matchesCategory = selectedCategory === 'all' || contact.category === selectedCategory;
                
                return matchesSearch && matchesCategory;
            });

            const categories = ['all', 'famille', 'amis', 'travail', 'client', 'fournisseur', 'autre'];

            if (loading) {
                return (
                    <div className="min-h-screen gradient-bg flex items-center justify-center">
                        <div className="text-white text-center">
                            <div className="floating">
                                <i className="fas fa-address-book text-6xl mb-4"></i>
                            </div>
                            <p className="text-xl">Chargement...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    {notification && (
                        <div className={`fixed top-4 right-4 z-50 px-6 py-3 rounded-full shadow-lg slide-in ${
                            notification.type === 'error' ? 'bg-red-500' : 'bg-green-500'
                        } text-white`}>
                            <i className={`fas ${notification.type === 'error' ? 'fa-exclamation-circle' : 'fa-check-circle'} mr-2`}></i>
                            {notification.message}
                        </div>
                    )}

                    {!isAuthenticated ? (
                        <LoginScreen onLogin={handleLogin} />
                    ) : (
                        <Dashboard
                            user={user}
                            contacts={filteredContacts}
                            allContacts={contacts}
                            searchTerm={searchTerm}
                            setSearchTerm={setSearchTerm}
                            selectedCategory={selectedCategory}
                            setSelectedCategory={setSelectedCategory}
                            categories={categories}
                            syncing={syncing}
                            onAddContact={handleAddContact}
                            onUpdateContact={handleUpdateContact}
                            onDeleteContact={handleDeleteContact}
                            onSync={syncToGitHub}
                            onLogout={handleLogout}
                        />
                    )}
                </div>
            );
        }

        // Écran de connexion moderne
        function LoginScreen({ onLogin }) {
            const [token, setToken] = useState('');
            const [showInstructions, setShowInstructions] = useState(false);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (token.trim()) {
                    onLogin(token.trim());
                }
            };

            return (
                <div className="min-h-screen gradient-bg flex items-center justify-center p-4">
                    <div className="w-full max-w-md">
                        <div className="glass-effect rounded-3xl shadow-2xl p-10">
                            <div className="text-center mb-8">
                                <div className="inline-block p-4 bg-white rounded-full shadow-lg mb-4">
                                    <i className="fas fa-address-book text-5xl text-purple-600"></i>
                                </div>
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">Gestionnaire de Contacts</h1>
                                <p className="text-gray-600">Connectez-vous avec GitHub</p>
                            </div>

                            <form onSubmit={handleSubmit} className="space-y-6">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Token GitHub
                                    </label>
                                    <div className="relative">
                                        <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i className="fab fa-github text-gray-400"></i>
                                        </div>
                                        <input
                                            type="password"
                                            required
                                            className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-4 focus:ring-purple-200 focus:border-purple-500 transition"
                                            placeholder="ghp_xxxxxxxxxxxxxxxxxxxx"
                                            value={token}
                                            onChange={(e) => setToken(e.target.value)}
                                        />
                                    </div>
                                </div>

                                <button
                                    type="submit"
                                    className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-xl font-semibold hover:from-purple-700 hover:to-pink-700 transform hover:scale-105 transition shadow-lg"
                                >
                                    <i className="fas fa-sign-in-alt mr-2"></i>
                                    Se connecter
                                </button>
                            </form>

                            <div className="mt-6 text-center">
                                <button
                                    onClick={() => setShowInstructions(!showInstructions)}
                                    className="text-purple-600 hover:text-purple-700 text-sm font-medium"
                                >
                                    <i className="fas fa-question-circle mr-1"></i>
                                    Comment obtenir un token?
                                </button>
                            </div>

                            {showInstructions && (
                                <div className="mt-4 p-4 bg-purple-50 rounded-xl text-sm space-y-2 slide-in">
                                    <p className="font-semibold text-purple-800">Instructions :</p>
                                    <ol className="list-decimal list-inside space-y-1 text-gray-700">
                                        <li>Allez sur <a href="https://github.com/settings/tokens" target="_blank" className="text-purple-600 hover:underline">GitHub Settings</a></li>
                                        <li>Cliquez sur "Generate new token"</li>
                                        <li>Sélectionnez le scope <code className="bg-gray-200 px-1 rounded">gist</code></li>
                                        <li>Générez et copiez le token</li>
                                    </ol>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Dashboard principal moderne
        function Dashboard({
            user,
            contacts,
            allContacts,
            searchTerm,
            setSearchTerm,
            selectedCategory,
            setSelectedCategory,
            categories,
            syncing,
            onAddContact,
            onUpdateContact,
            onDeleteContact,
            onSync,
            onLogout
        }) {
            const [showAddModal, setShowAddModal] = useState(false);
            const [editingContact, setEditingContact] = useState(null);
            const [viewMode, setViewMode] = useState('grid');

            const stats = {
                total: allContacts.length,
                famille: allContacts.filter(c => c.category === 'famille').length,
                travail: allContacts.filter(c => c.category === 'travail').length,
                recent: allContacts.filter(c => {
                    const date = new Date(c.createdAt);
                    const now = new Date();
                    const diffDays = (now - date) / (1000 * 60 * 60 * 24);
                    return diffDays <= 7;
                }).length
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header moderne */}
                    <header className="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-40">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center h-16">
                                <div className="flex items-center space-x-4">
                                    <div className="p-2 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg">
                                        <i className="fas fa-address-book text-white text-xl"></i>
                                    </div>
                                    <div>
                                        <h1 className="text-xl font-semibold text-gray-900">Gestionnaire de Contacts</h1>
                                        <p className="text-xs text-gray-500">Professionnel & Sécurisé</p>
                                    </div>
                                </div>

                                <div className="flex items-center space-x-4">
                                    {syncing && (
                                        <div className="text-purple-600 text-sm">
                                            <i className="fas fa-sync fa-spin mr-1"></i>
                                            Synchronisation...
                                        </div>
                                    )}
                                    
                                    <button
                                        onClick={onSync}
                                        className="p-2 text-gray-600 hover:text-purple-600 transition"
                                        disabled={syncing}
                                    >
                                        <i className="fas fa-cloud-upload-alt text-xl"></i>
                                    </button>

                                    <div className="flex items-center space-x-2 px-3 py-1 bg-gray-100 rounded-full">
                                        <img 
                                            src={user.avatar_url} 
                                            alt={user.login}
                                            className="w-8 h-8 rounded-full"
                                        />
                                        <span className="text-sm font-medium text-gray-700">{user.login}</span>
                                    </div>

                                    <button
                                        onClick={onLogout}
                                        className="p-2 text-gray-600 hover:text-red-600 transition"
                                    >
                                        <i className="fas fa-sign-out-alt text-xl"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Statistiques cards */}
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                            <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-600 mb-1">Total Contacts</p>
                                        <p className="text-3xl font-bold text-gray-900">{stats.total}</p>
                                    </div>
                                    <div className="p-3 bg-purple-100 rounded-full">
                                        <i className="fas fa-users text-purple-600 text-xl"></i>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-600 mb-1">Famille</p>
                                        <p className="text-3xl font-bold text-gray-900">{stats.famille}</p>
                                    </div>
                                    <div className="p-3 bg-pink-100 rounded-full">
                                        <i className="fas fa-home text-pink-600 text-xl"></i>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-600 mb-1">Travail</p>
                                        <p className="text-3xl font-bold text-gray-900">{stats.travail}</p>
                                    </div>
                                    <div className="p-3 bg-blue-100 rounded-full">
                                        <i className="fas fa-briefcase text-blue-600 text-xl"></i>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-600 mb-1">Récents (7j)</p>
                                        <p className="text-3xl font-bold text-gray-900">{stats.recent}</p>
                                    </div>
                                    <div className="p-3 bg-green-100 rounded-full">
                                        <i className="fas fa-clock text-green-600 text-xl"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Barre d'outils */}
                        <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-8">
                            <div className="flex flex-wrap gap-4 items-center justify-between">
                                <div className="flex flex-wrap gap-3 items-center flex-1">
                                    {/* Recherche */}
                                    <div className="relative flex-1 max-w-md">
                                        <input
                                            type="text"
                                            placeholder="Rechercher un contact..."
                                            className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-xl focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition"
                                            value={searchTerm}
                                            onChange={(e) => setSearchTerm(e.target.value)}
                                        />
                                        <i className="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                                    </div>

                                    {/* Catégories */}
                                    <div className="flex gap-2">
                                        {categories.map(cat => (
                                            <button
                                                key={cat}
                                                onClick={() => setSelectedCategory(cat)}
                                                className={`px-4 py-2 rounded-xl font-medium transition ${
                                                    selectedCategory === cat
                                                        ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white'
                                                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                                }`}
                                            >
                                                {cat === 'all' ? 'Tous' : cat.charAt(0).toUpperCase() + cat.slice(1)}
                                            </button>
                                        ))}
                                    </div>

                                    {/* Mode d'affichage */}
                                    <div className="flex bg-gray-100 rounded-lg p-1">
                                        <button
                                            className={`px-3 py-1 rounded ${viewMode === 'grid' ? 'bg-white shadow' : ''}`}
                                            onClick={() => setViewMode('grid')}
                                        >
                                            <i className="fas fa-th text-gray-600"></i>
                                        </button>
                                        <button
                                            className={`px-3 py-1 rounded ${viewMode === 'list' ? 'bg-white shadow' : ''}`}
                                            onClick={() => setViewMode('list')}
                                        >
                                            <i className="fas fa-list text-gray-600"></i>
                                        </button>
                                    </div>
                                </div>

                                <button
                                    onClick={() => setShowAddModal(true)}
                                    className="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-2 rounded-xl font-medium hover:from-purple-700 hover:to-pink-700 transform hover:scale-105 transition shadow-lg"
                                >
                                    <i className="fas fa-plus mr-2"></i>
                                    Nouveau Contact
                                </button>
                            </div>
                        </div>

                        {/* Liste des contacts */}
                        {contacts.length === 0 ? (
                            <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-16 text-center">
                                <div className="floating">
                                    <i className="fas fa-user-friends text-gray-300 text-6xl mb-4"></i>
                                </div>
                                <p className="text-gray-500 text-lg mb-4">Aucun contact trouvé</p>
                                <button
                                    onClick={() => setShowAddModal(true)}
                                    className="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-3 rounded-xl font-medium hover:from-purple-700 hover:to-pink-700 transform hover:scale-105 transition shadow-lg"
                                >
                                    <i className="fas fa-plus mr-2"></i>
                                    Ajouter votre premier contact
                                </button>
                            </div>
                        ) : (
                            <div className={viewMode === 'grid' ? 
                                'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6' : 
                                'space-y-3'
                            }>
                                {contacts.map(contact => (
                                    <ContactCard
                                        key={contact.id}
                                        contact={contact}
                                        viewMode={viewMode}
                                        onEdit={() => setEditingContact(contact)}
                                        onDelete={() => onDeleteContact(contact.id)}
                                    />
                                ))}
                            </div>
                        )}
                    </div>

                    {/* Modals */}
                    {(showAddModal || editingContact) && (
                        <ContactModal
                            contact={editingContact}
                            categories={categories.filter(c => c !== 'all')}
                            onSave={(data) => {
                                if (editingContact) {
                                    onUpdateContact(editingContact.id, data);
                                } else {
                                    onAddContact(data);
                                }
                                setShowAddModal(false);
                                setEditingContact(null);
                            }}
                            onClose={() => {
                                setShowAddModal(false);
                                setEditingContact(null);
                            }}
                        />
                    )}
                </div>
            );
        }

        // Carte de contact moderne
        function ContactCard({ contact, viewMode, onEdit, onDelete }) {
            const getCategoryColor = (category) => {
                const colors = {
                    famille: 'bg-pink-100 text-pink-700',
                    amis: 'bg-purple-100 text-purple-700',
                    travail: 'bg-blue-100 text-blue-700',
                    client: 'bg-green-100 text-green-700',
                    fournisseur: 'bg-yellow-100 text-yellow-700',
                    autre: 'bg-gray-100 text-gray-700'
                };
                return colors[category] || colors.autre;
            };

            const getInitials = (name) => {
                return name
                    .split(' ')
                    .map(word => word[0])
                    .join('')
                    .toUpperCase()
                    .slice(0, 2);
            };

            if (viewMode === 'list') {
                return (
                    <div className="contact-card p-4 flex items-center justify-between">
                        <div className="flex items-center space-x-4">
                            <div className="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white font-bold">
                                {getInitials(contact.name || '?')}
                            </div>
                            <div>
                                <h3 className="font-semibold text-gray-900">{contact.name}</h3>
                                <div className="flex items-center space-x-3 text-sm text-gray-600">
                                    {contact.email && <span><i className="fas fa-envelope mr-1"></i>{contact.email}</span>}
                                    {contact.phone && <span><i className="fas fa-phone mr-1"></i>{contact.phone}</span>}
                                </div>
                            </div>
                        </div>
                        
                        <div className="flex items-center space-x-2">
                            {contact.category && (
                                <span className={`px-3 py-1 rounded-full text-xs font-medium ${getCategoryColor(contact.category)}`}>
                                    {contact.category}
                                </span>
                            )}
                            
                            <button
                                onClick={onEdit}
                                className="p-2 text-purple-600 hover:bg-purple-50 rounded-lg transition"
                            >
                                <i className="fas fa-edit"></i>
                            </button>
                            <button
                                onClick={onDelete}
                                className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition"
                            >
                                <i className="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="contact-card">
                    <div className="p-6">
                        <div className="flex justify-between items-start mb-4">
                            <div className="w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white font-bold text-xl">
                                {getInitials(contact.name || '?')}
                            </div>
                            {contact.category && (
                                <span className={`px-3 py-1 rounded-full text-xs font-medium ${getCategoryColor(contact.category)}`}>
                                    {contact.category}
                                </span>
                            )}
                        </div>

                        <h3 className="text-lg font-semibold text-gray-900 mb-3">{contact.name}</h3>
                        
                        <div className="space-y-2 text-sm text-gray-600">
                            {contact.email && (
                                <div className="flex items-center">
                                    <i className="fas fa-envelope w-5 text-purple-400"></i>
                                    <span className="ml-2 truncate">{contact.email}</span>
                                </div>
                            )}
                            {contact.phone && (
                                <div className="flex items-center">
                                    <i className="fas fa-phone w-5 text-purple-400"></i>
                                    <span className="ml-2">{contact.phone}</span>
                                </div>
                            )}
                            {contact.company && (
                                <div className="flex items-center">
                                    <i className="fas fa-building w-5 text-purple-400"></i>
                                    <span className="ml-2">{contact.company}</span>
                                </div>
                            )}
                            {contact.address && (
                                <div className="flex items-center">
                                    <i className="fas fa-map-marker-alt w-5 text-purple-400"></i>
                                    <span className="ml-2">{contact.address}</span>
                                </div>
                            )}
                        </div>

                        {contact.notes && (
                            <div className="mt-4 p-3 bg-gray-50 rounded-lg text-sm text-gray-600">
                                <i className="fas fa-sticky-note mr-2 text-purple-400"></i>
                                {contact.notes}
                            </div>
                        )}

                        <div className="mt-4 flex space-x-2 pt-4 border-t border-gray-100">
                            <button
                                onClick={onEdit}
                                className="flex-1 bg-purple-50 text-purple-600 py-2 rounded-lg hover:bg-purple-100 transition font-medium"
                            >
                                <i className="fas fa-edit mr-2"></i>
                                Modifier
                            </button>
                            <button
                                onClick={onDelete}
                                className="p-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition"
                            >
                                <i className="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Modal d'ajout/édition moderne
        function ContactModal({ contact, categories, onSave, onClose }) {
            const [formData, setFormData] = useState({
                name: contact?.name || '',
                email: contact?.email || '',
                phone: contact?.phone || '',
                company: contact?.company || '',
                address: contact?.address || '',
                category: contact?.category || 'autre',
                notes: contact?.notes || ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className="bg-white rounded-2xl max-w-md w-full p-6 slide-in">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold text-gray-900">
                                {contact ? 'Modifier le contact' : 'Nouveau contact'}
                            </h2>
                            <button
                                onClick={onClose}
                                className="p-2 hover:bg-gray-100 rounded-lg transition"
                            >
                                <i className="fas fa-times text-gray-500"></i>
                            </button>
                        </div>
                        
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Nom complet *
                                </label>
                                <input
                                    type="text"
                                    required
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition"
                                    value={formData.name}
                                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Email
                                </label>
                                <input
                                    type="email"
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition"
                                    value={formData.email}
                                    onChange={(e) => setFormData({...formData, email: e.target.value})}
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Téléphone
                                </label>
                                <input
                                    type="tel"
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition"
                                    value={formData.phone}
                                    onChange={(e) => setFormData({...formData, phone: e.target.value})}
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Entreprise
                                </label>
                                <input
                                    type="text"
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition"
                                    value={formData.company}
                                    onChange={(e) => setFormData({...formData, company: e.target.value})}
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Adresse
                                </label>
                                <input
                                    type="text"
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition"
                                    value={formData.address}
                                    onChange={(e) => setFormData({...formData, address: e.target.value})}
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Catégorie
                                </label>
                                <select
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition"
                                    value={formData.category}
                                    onChange={(e) => setFormData({...formData, category: e.target.value})}
                                >
                                    {categories.map(cat => (
                                        <option key={cat} value={cat}>
                                            {cat.charAt(0).toUpperCase() + cat.slice(1)}
                                        </option>
                                    ))}
                                </select>
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Notes
                                </label>
                                <textarea
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition"
                                    rows="3"
                                    value={formData.notes}
                                    onChange={(e) => setFormData({...formData, notes: e.target.value})}
                                ></textarea>
                            </div>

                            <div className="flex space-x-3 pt-4">
                                <button
                                    type="submit"
                                    className="flex-1 bg-gradient-to-r from-purple-600 to-pink-600 text-white py-2 rounded-lg font-medium hover:from-purple-700 hover:to-pink-700 transform hover:scale-105 transition"
                                >
                                    <i className="fas fa-save mr-2"></i>
                                    {contact ? 'Mettre à jour' : 'Enregistrer'}
                                </button>
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="flex-1 bg-gray-100 text-gray-700 py-2 rounded-lg font-medium hover:bg-gray-200 transition"
                                >
                                    Annuler
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Rendu de l'application
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>