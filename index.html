<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IAN - √âcosyst√®me Interactif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #006a6f 0%, #004d52 100%);
            min-height: 100%;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
        }
        
        .nav-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .nav-card:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .page-container {
            display: none;
        }
        .page-container.active {
            display: block;
        }
        
        .tool-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .tool-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 24px;
        }
        
        .contact-card {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .contact-card:hover {
            transform: translateY(-2px) scale(1.1);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #6b7280;
            z-index: 10;
        }
        
        .star-rating {
            display: inline-flex;
            gap: 2px;
        }
        .star {
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
            filter: grayscale(100%);
            transform: scale(1);
        }
        .star:hover {
            color: #fbbf24;
            filter: grayscale(0%);
            transform: scale(1.2);
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }
        .star.active {
            color: #f59e0b;
            filter: grayscale(0%);
            transform: scale(1.1);
            text-shadow: 0 0 8px rgba(245, 158, 11, 0.4);
        }
        .star.active:hover {
            transform: scale(1.3);
        }
        
        .urgence-filter-btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .urgence-filter-btn:hover {
            transform: scale(1.05);
        }
        
        .urgence-filter-btn.active {
            transform: scale(1.08);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .urgence-filter-btn.urgente {
            background-color: #fee2e2;
            color: #dc2626;
            border-color: #fecaca;
        }
        .urgence-filter-btn.urgente.active {
            background-color: #dc2626;
            color: white;
            border-color: #dc2626;
        }
        
        .urgence-filter-btn.importante {
            background-color: #fed7aa;
            color: #ea580c;
            border-color: #fdba74;
        }
        .urgence-filter-btn.importante.active {
            background-color: #ea580c;
            color: white;
            border-color: #ea580c;
        }
        
        .urgence-filter-btn.normale {
            background-color: #dbeafe;
            color: #2563eb;
            border-color: #bfdbfe;
        }
        .urgence-filter-btn.normale.active {
            background-color: #2563eb;
            color: white;
            border-color: #2563eb;
        }
        
        .login-screen {
            display: none;
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #006a6f 0%, #004d52 100%);
            z-index: 9999;
        }
        .login-screen.active {
            display: flex;
        }
        
        .sync-indicator {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- √âcran de connexion GitHub -->
    <div id="login-screen" class="login-screen active items-center justify-center p-4">
        <div class="max-w-md w-full">
            <div class="bg-white bg-opacity-95 backdrop-blur rounded-3xl shadow-2xl p-10">
                <div class="text-center mb-8">
                    <div class="inline-block p-4 bg-gradient-to-br from-teal-400 to-teal-600 rounded-full shadow-lg mb-4">
                        <svg class="w-16 h-16 text-white" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
                        </svg>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">IAN - √âcosyst√®me Interactif</h1>
                    <p class="text-gray-600">Connectez-vous avec GitHub pour synchroniser vos donn√©es</p>
                </div>

                <form id="login-form" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Token GitHub Personnel
                        </label>
                        <div class="relative">
                            <input
                                type="password"
                                id="github-token"
                                required
                                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-4 focus:ring-teal-200 focus:border-teal-500 transition"
                                placeholder="ghp_xxxxxxxxxxxxxxxxxxxx"
                            >
                            <button type="button" onclick="toggleTokenVisibility()" class="absolute right-3 top-3 text-gray-500 hover:text-gray-700">
                                <span id="toggle-icon">üëÅÔ∏è</span>
                            </button>
                        </div>
                    </div>

                    <button
                        type="submit"
                        class="w-full bg-gradient-to-r from-teal-500 to-teal-600 text-white py-3 rounded-xl font-semibold hover:from-teal-600 hover:to-teal-700 transform hover:scale-105 transition shadow-lg"
                    >
                        <span class="flex items-center justify-center space-x-2">
                            <span>Se connecter avec GitHub</span>
                            <span>‚Üí</span>
                        </span>
                    </button>
                </form>

                <div class="mt-6 text-center">
                    <button
                        onclick="toggleInstructions()"
                        class="text-teal-600 hover:text-teal-700 text-sm font-medium"
                    >
                        ‚ÑπÔ∏è Comment obtenir un token GitHub?
                    </button>
                </div>

                <div id="instructions" class="hidden mt-4 p-4 bg-teal-50 rounded-xl text-sm space-y-2">
                    <p class="font-semibold text-teal-800">Instructions :</p>
                    <ol class="list-decimal list-inside space-y-1 text-gray-700">
                        <li>Allez sur <a href="https://github.com/settings/tokens/new" target="_blank" class="text-teal-600 hover:underline">GitHub Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí Tokens (classic)</a></li>
                        <li>Cliquez sur "Generate new token (classic)"</li>
                        <li>Donnez un nom au token (ex: "IAN Ecosystem")</li>
                        <li><strong>Important:</strong> S√©lectionnez UNIQUEMENT le scope <code class="bg-gray-200 px-1 rounded font-mono">gist</code> (cochez la case)</li>
                        <li>Choisissez une expiration (30, 60, 90 jours ou "No expiration")</li>
                        <li>Cliquez sur "Generate token" en bas de page</li>
                        <li>Copiez le token complet (commence par <code class="bg-gray-200 px-1 rounded font-mono">ghp_</code>) et collez-le ci-dessus</li>
                    </ol>
                    <p class="text-yellow-700 bg-yellow-100 p-2 rounded">
                        ‚ö†Ô∏è Gardez votre token secret et ne le partagez jamais! Le token doit avoir le scope "gist" pour fonctionner.
                    </p>
                    <p class="text-blue-700 bg-blue-100 p-2 rounded mt-2">
                        üí° Le token commence toujours par "ghp_" suivi de 36 caract√®res alphanum√©riques.
                    </p>
                </div>
            </div>

            <div class="mt-4 text-center">
                <p class="text-teal-100 text-sm">
                    Vos donn√©es seront stock√©es de mani√®re s√©curis√©e dans vos Gists GitHub priv√©s
                </p>
            </div>
        </div>
    </div>

    <!-- Application principale -->
    <div id="main-app" style="display: none;">
        <!-- Barre de synchronisation GitHub -->
        <div id="sync-bar" class="fixed top-0 left-0 right-0 bg-white bg-opacity-95 backdrop-blur shadow-sm z-50">
            <div class="max-w-6xl mx-auto px-4 py-2 flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <img id="user-avatar" src="" alt="" class="w-8 h-8 rounded-full" style="display: none;">
                    <span id="user-name" class="text-sm font-medium text-gray-700"></span>
                    <span id="sync-status" class="text-xs text-gray-500 flex items-center">
                        <span class="sync-indicator">‚óè</span>
                        <span class="ml-1">Synchronis√©</span>
                    </span>
                </div>
                <div class="flex items-center space-x-2">
                    <button onclick="manualSync()" class="px-3 py-1 bg-teal-100 text-teal-700 rounded-lg text-sm hover:bg-teal-200 transition">
                        üîÑ Synchroniser
                    </button>
                    <button onclick="logout()" class="px-3 py-1 bg-red-100 text-red-700 rounded-lg text-sm hover:bg-red-200 transition">
                        üö™ D√©connexion
                    </button>
                </div>
            </div>
        </div>

        <!-- Contenu original de l'application (avec padding-top pour la barre) -->
        <div style="padding-top: 48px;">
            <!-- Page d'accueil -->
            <div id="home-page" class="page-container active">
                <div class="max-w-6xl mx-auto p-6">
                    <header class="text-center mb-12">
                        <h1 class="text-4xl font-bold text-white mb-3">IAN - √âcosyst√®me Interactif</h1>
                        <p class="text-teal-100 text-lg">Interlocuteur Acad√©mique pour le Num√©rique - Acad√©mie Orl√©ans-Tours</p>
                    </header>

                    <!-- Grille de navigation -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <!-- Arborescence de l'√©cosyst√®me -->
                        <div class="nav-card bg-white rounded-xl shadow-lg p-6 text-center" onclick="navigateTo('ecosystem')">
                            <div class="w-16 h-16 bg-gradient-to-br from-teal-400 to-teal-600 rounded-full flex items-center justify-center text-white text-2xl mx-auto mb-4">
                                üåê
                            </div>
                            <h3 class="text-xl font-semibold text-gray-900 mb-2">Arborescence de l'√©cosyst√®me</h3>
                            <div class="text-xs text-gray-500 mb-3 font-medium">üë§ Espace individuel</div>
                            <p class="text-gray-600 mb-4">D√©couvrez les acteurs et leurs interactions dans l'√©cosyst√®me IAN</p>
                            <div class="inline-flex items-center text-teal-600 font-medium">
                                <span>Explorer</span>
                                <span class="ml-2">‚Üí</span>
                            </div>
                        </div>

                        <!-- Annuaire des IAN -->
                        <div class="nav-card bg-white rounded-xl shadow-lg p-6 text-center" onclick="navigateTo('directory')">
                            <div class="w-16 h-16 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-full flex items-center justify-center text-white text-2xl mx-auto mb-4">
                                üë•
                            </div>
                            <h3 class="text-xl font-semibold text-gray-900 mb-2">Annuaire des IAN</h3>
                            <div class="text-xs text-gray-500 mb-3 font-medium">ü§ù Espace collaboratif</div>
                            <p class="text-gray-600 mb-4">R√©pertoire collaboratif des IAN de l'acad√©mie Orl√©ans-Tours</p>
                            <div class="inline-flex items-center text-emerald-600 font-medium">
                                <span>Explorer</span>
                                <span class="ml-2">‚Üí</span>
                            </div>
                        </div>

                        <!-- Newsletter d'informations -->
                        <div class="nav-card bg-white rounded-xl shadow-lg p-6 text-center" onclick="navigateTo('newsletter')">
                            <div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center text-white text-2xl mx-auto mb-4">
                                üì∞
                            </div>
                            <h3 class="text-xl font-semibold text-gray-900 mb-2">Newsletter d'informations</h3>
                            <div class="text-xs text-gray-500 mb-3 font-medium">ü§ù Espace collaboratif</div>
                            <p class="text-gray-600 mb-4">Cr√©ez et partagez vos newsletters trimestrielles collaboratives</p>
                            <div class="inline-flex items-center text-orange-600 font-medium">
                                <span>Explorer</span>
                                <span class="ml-2">‚Üí</span>
                            </div>
                        </div>

                        <!-- Usages du num√©rique -->
                        <div class="nav-card bg-white rounded-xl shadow-lg p-6 text-center" onclick="navigateTo('usages')">
                            <div class="w-16 h-16 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center text-white text-2xl mx-auto mb-4">
                                üíª
                            </div>
                            <h3 class="text-xl font-semibold text-gray-900 mb-2">Usages du num√©rique</h3>
                            <div class="text-xs text-gray-500 mb-3 font-medium">ü§ù Espace collaboratif</div>
                            <p class="text-gray-600 mb-4">Pratiques p√©dagogiques num√©riques par discipline</p>
                            <div class="inline-flex items-center text-purple-600 font-medium">
                                <span>Explorer</span>
                                <span class="ml-2">‚Üí</span>
                            </div>
                        </div>
                    </div>

                    <!-- Section informative -->
                    <div class="bg-white bg-opacity-10 rounded-xl p-8 text-white text-center">
                        <h3 class="text-2xl font-semibold mb-4">Bienvenue dans l'√©cosyst√®me IAN</h3>
                        <p class="text-teal-100 text-lg leading-relaxed max-w-3xl mx-auto">
                            Explorez les diff√©rentes facettes du r√¥le d'Interlocuteur Acad√©mique pour le Num√©rique. 
                            D√©couvrez les acteurs cl√©s, les outils essentiels et les usages p√©dagogiques qui structurent 
                            votre mission d'accompagnement au num√©rique √©ducatif de la DRANE Orl√©ans-Tours.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Les autres pages seront ajout√©es ici -->
            <div id="ecosystem-page" class="page-container">
                <div class="max-w-6xl mx-auto p-6">
                    <div class="breadcrumb">
                        <button onclick="navigateTo('home')" class="text-teal-200 hover:text-white transition-colors">üè† Accueil</button>
                        <span class="text-teal-300">></span>
                        <span class="text-white font-medium">Arborescence de l'√©cosyst√®me</span>
                    </div>
                    <header class="mb-8">
                        <h1 class="text-3xl font-bold text-white mb-2">Arborescence de l'√©cosyst√®me IAN</h1>
                        <p class="text-teal-100">Cartographie des acteurs et relations professionnelles</p>
                    </header>
                    <!-- Le contenu sera charg√© depuis GitHub -->
                    <div id="ecosystem-content" class="bg-white rounded-xl shadow-lg p-6">
                        <p class="text-gray-600">Chargement...</p>
                    </div>
                </div>
            </div>

            <div id="directory-page" class="page-container">
                <div class="max-w-6xl mx-auto p-6">
                    <div class="breadcrumb">
                        <button onclick="navigateTo('home')" class="text-teal-200 hover:text-white transition-colors">üè† Accueil</button>
                        <span class="text-teal-300">></span>
                        <span class="text-white font-medium">Annuaire des IAN</span>
                    </div>
                    <header class="mb-8">
                        <h1 class="text-3xl font-bold text-white mb-2">Annuaire des IAN</h1>
                        <p class="text-teal-100">R√©pertoire collaboratif des interlocuteurs acad√©miques</p>
                    </header>
                    <!-- Le contenu sera charg√© depuis GitHub -->
                    <div id="directory-content" class="bg-white rounded-xl shadow-lg p-6">
                        <p class="text-gray-600">Chargement...</p>
                    </div>
                </div>
            </div>

            <div id="newsletter-page" class="page-container">
                <div class="max-w-6xl mx-auto p-6">
                    <div class="breadcrumb">
                        <button onclick="navigateTo('home')" class="text-teal-200 hover:text-white transition-colors">üè† Accueil</button>
                        <span class="text-teal-300">></span>
                        <span class="text-white font-medium">Newsletter d'informations</span>
                    </div>
                    <header class="mb-8">
                        <h1 class="text-3xl font-bold text-white mb-2">Newsletter d'informations</h1>
                        <p class="text-teal-100">Cr√©ez et partagez vos newsletters trimestrielles</p>
                    </header>
                    <!-- Le contenu sera charg√© depuis GitHub -->
                    <div id="newsletter-content" class="bg-white rounded-xl shadow-lg p-6">
                        <p class="text-gray-600">Chargement...</p>
                    </div>
                </div>
            </div>

            <div id="usages-page" class="page-container">
                <div class="max-w-6xl mx-auto p-6">
                    <div class="breadcrumb">
                        <button onclick="navigateTo('home')" class="text-teal-200 hover:text-white transition-colors">üè† Accueil</button>
                        <span class="text-teal-300">></span>
                        <span class="text-white font-medium">Usages du num√©rique</span>
                    </div>
                    <header class="mb-8">
                        <h1 class="text-3xl font-bold text-white mb-2">Usages du num√©rique</h1>
                        <p class="text-teal-100">Pratiques p√©dagogiques num√©riques par discipline</p>
                    </header>
                    <!-- Le contenu sera charg√© depuis GitHub -->
                    <div id="usages-content" class="bg-white rounded-xl shadow-lg p-6">
                        <p class="text-gray-600">Chargement...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Service GitHub
        class GitHubService {
            constructor() {
                this.baseURL = 'https://api.github.com';
                this.token = null;
                this.username = null;
                this.mainGistId = null;
            }

            setCredentials(token, username) {
                this.token = token;
                this.username = username;
                localStorage.setItem('github_token', token);
                localStorage.setItem('github_username', username);
            }

            getStoredCredentials() {
                return {
                    token: localStorage.getItem('github_token'),
                    username: localStorage.getItem('github_username')
                };
            }

            clearCredentials() {
                this.token = null;
                this.username = null;
                this.mainGistId = null;
                localStorage.removeItem('github_token');
                localStorage.removeItem('github_username');
                localStorage.removeItem('ian_main_gist_id');
            }

            async verifyToken(token) {
                try {
                    const response = await fetch(`${this.baseURL}/user`, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });

                    if (response.ok) {
                        const user = await response.json();
                        return { valid: true, username: user.login, user };
                    }

                    // Log detailed error information
                    const errorText = await response.text();
                    console.error('GitHub API error:', {
                        status: response.status,
                        statusText: response.statusText,
                        body: errorText
                    });

                    return {
                        valid: false,
                        error: `Erreur ${response.status}: ${response.statusText}`,
                        details: errorText
                    };
                } catch (error) {
                    console.error('Token verification error:', error);
                    return {
                        valid: false,
                        error: 'Erreur de connexion: ' + error.message
                    };
                }
            }

            async createGist(data, description = 'IAN Ecosystem Data', isPublic = false) {
                if (!this.token) throw new Error('No token configured');

                const response = await fetch(`${this.baseURL}/gists`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${this.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        description,
                        public: isPublic,
                        files: {
                            'ian-ecosystem.json': {
                                content: JSON.stringify(data, null, 2)
                            }
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to create gist');
                }

                return await response.json();
            }

            async updateGist(gistId, data, description) {
                if (!this.token) throw new Error('No token configured');

                const response = await fetch(`${this.baseURL}/gists/${gistId}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `token ${this.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        description: description || 'IAN Ecosystem Data - Updated',
                        files: {
                            'ian-ecosystem.json': {
                                content: JSON.stringify(data, null, 2)
                            }
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to update gist');
                }

                return await response.json();
            }

            async getGist(gistId) {
                const headers = {
                    'Accept': 'application/vnd.github.v3+json'
                };

                if (this.token) {
                    headers['Authorization'] = `token ${this.token}`;
                }

                const response = await fetch(`${this.baseURL}/gists/${gistId}`, {
                    headers
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch gist');
                }

                const gist = await response.json();
                const content = gist.files['ian-ecosystem.json']?.content;
                
                if (content) {
                    return JSON.parse(content);
                }
                
                return null;
            }

            async listGists() {
                if (!this.token || !this.username) return [];

                const response = await fetch(`${this.baseURL}/users/${this.username}/gists`, {
                    headers: {
                        'Authorization': `token ${this.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (!response.ok) return [];

                const gists = await response.json();
                return gists.filter(g => 
                    g.files['ian-ecosystem.json'] && 
                    g.description?.includes('IAN Ecosystem')
                );
            }
        }

        const githubService = new GitHubService();

        // Structure de donn√©es globale
        let appData = {
            ianProfile: {
                avatar: 'üë§',
                name: '',
                academy: 'Orl√©ans-Tours',
                discipline: '',
                email: '',
                objectives: ''
            },
            directoryProfiles: [],
            newsletters: [],
            actualites: [],
            usages: [],
            lastUpdated: null
        };

        // Gestion de l'authentification
        function toggleTokenVisibility() {
            const input = document.getElementById('github-token');
            const icon = document.getElementById('toggle-icon');
            if (input.type === 'password') {
                input.type = 'text';
                icon.textContent = 'üôà';
            } else {
                input.type = 'password';
                icon.textContent = 'üëÅÔ∏è';
            }
        }

        function toggleInstructions() {
            const instructions = document.getElementById('instructions');
            instructions.classList.toggle('hidden');
        }

        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const token = document.getElementById('github-token').value;
            const submitButton = e.target.querySelector('button[type="submit"]');

            // D√©sactiver le bouton pendant la v√©rification
            submitButton.disabled = true;
            submitButton.innerHTML = '<span class="flex items-center justify-center space-x-2"><span>V√©rification...</span></span>';

            // V√©rifier le token
            const result = await githubService.verifyToken(token);

            if (result.valid) {
                githubService.setCredentials(token, result.username);

                // Mettre √† jour l'interface utilisateur
                document.getElementById('user-name').textContent = result.username;
                if (result.user.avatar_url) {
                    const avatar = document.getElementById('user-avatar');
                    avatar.src = result.user.avatar_url;
                    avatar.style.display = 'block';
                }

                // Charger les donn√©es depuis GitHub
                await loadDataFromGitHub();

                // Afficher l'application principale
                document.getElementById('login-screen').classList.remove('active');
                document.getElementById('main-app').style.display = 'block';
            } else {
                // Afficher un message d'erreur d√©taill√©
                let errorMessage = 'Token GitHub invalide. Veuillez v√©rifier et r√©essayer.';
                if (result.error) {
                    errorMessage = result.error;
                }

                // V√©rifier les erreurs courantes
                if (result.details) {
                    try {
                        const errorData = JSON.parse(result.details);
                        if (errorData.message) {
                            errorMessage += '\n\nD√©tails: ' + errorData.message;
                        }
                    } catch (e) {
                        // Ignorer si ce n'est pas du JSON
                    }
                }

                alert(errorMessage + '\n\nAssurez-vous que:\n- Le token est valide\n- Le token a le scope "gist"\n- Vous avez copi√© le token complet');

                // R√©activer le bouton
                submitButton.disabled = false;
                submitButton.innerHTML = '<span class="flex items-center justify-center space-x-2"><span>Se connecter avec GitHub</span><span>‚Üí</span></span>';
            }
        });

        // Chargement des donn√©es depuis GitHub
        async function loadDataFromGitHub() {
            updateSyncStatus('Chargement...');
            
            try {
                // V√©rifier s'il y a un Gist principal stock√©
                const storedGistId = localStorage.getItem('ian_main_gist_id');
                if (storedGistId) {
                    const data = await githubService.getGist(storedGistId);
                    if (data) {
                        appData = { ...appData, ...data };
                        githubService.mainGistId = storedGistId;
                        updateSyncStatus('Synchronis√©');
                        return;
                    }
                }
                
                // Sinon, chercher un Gist existant
                const gists = await githubService.listGists();
                const mainGist = gists.find(g => g.description?.includes('[MAIN]'));
                
                if (mainGist) {
                    const data = await githubService.getGist(mainGist.id);
                    appData = { ...appData, ...data };
                    githubService.mainGistId = mainGist.id;
                    localStorage.setItem('ian_main_gist_id', mainGist.id);
                } else {
                    // Cr√©er un nouveau Gist
                    const gist = await githubService.createGist(
                        appData,
                        `[MAIN] IAN Ecosystem Data - ${githubService.username}`,
                        false
                    );
                    githubService.mainGistId = gist.id;
                    localStorage.setItem('ian_main_gist_id', gist.id);
                }
                
                updateSyncStatus('Synchronis√©');
            } catch (error) {
                console.error('Error loading data:', error);
                updateSyncStatus('Erreur de synchronisation');
            }
        }

        // Sauvegarde des donn√©es vers GitHub
        async function saveDataToGitHub() {
            if (!githubService.token || !githubService.mainGistId) return;
            
            updateSyncStatus('Synchronisation...');
            
            try {
                appData.lastUpdated = new Date().toISOString();
                
                await githubService.updateGist(
                    githubService.mainGistId,
                    appData,
                    `[MAIN] IAN Ecosystem Data - ${githubService.username}`
                );
                
                updateSyncStatus('Synchronis√©');
            } catch (error) {
                console.error('Error saving data:', error);
                updateSyncStatus('Erreur de synchronisation');
            }
        }

        // Synchronisation manuelle
        async function manualSync() {
            await saveDataToGitHub();
        }

        // Mise √† jour du statut de synchronisation
        function updateSyncStatus(status) {
            const statusElement = document.getElementById('sync-status');
            statusElement.innerHTML = `<span class="sync-indicator">‚óè</span><span class="ml-1">${status}</span>`;
        }

        // D√©connexion
        function logout() {
            if (confirm('Voulez-vous vraiment vous d√©connecter ?')) {
                githubService.clearCredentials();
                location.reload();
            }
        }

        // Navigation entre les pages
        function navigateTo(page) {
            // Masquer toutes les pages
            document.querySelectorAll('.page-container').forEach(p => p.classList.remove('active'));
            
            // Afficher la page demand√©e
            document.getElementById(`${page}-page`).classList.add('active');
            
            // Charger le contenu sp√©cifique √† la page
            loadPageContent(page);
        }

        // Chargement du contenu des pages
        function loadPageContent(page) {
            switch(page) {
                case 'ecosystem':
                    loadEcosystemContent();
                    break;
                case 'directory':
                    loadDirectoryContent();
                    break;
                case 'newsletter':
                    loadNewsletterContent();
                    break;
                case 'usages':
                    loadUsagesContent();
                    break;
            }
        }

        function loadEcosystemContent() {
            const content = document.getElementById('ecosystem-content');
            content.innerHTML = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-teal-50 to-teal-100 rounded-lg p-6">
                        <h2 class="text-2xl font-bold text-teal-800 mb-4">Mon Profil IAN</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nom</label>
                                <input type="text" id="profile-name" value="${appData.ianProfile.name || ''}" 
                                    onchange="updateProfile('name', this.value)"
                                    class="w-full px-3 py-2 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Discipline</label>
                                <input type="text" id="profile-discipline" value="${appData.ianProfile.discipline || ''}"
                                    onchange="updateProfile('discipline', this.value)"
                                    class="w-full px-3 py-2 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                <input type="email" id="profile-email" value="${appData.ianProfile.email || ''}"
                                    onchange="updateProfile('email', this.value)"
                                    class="w-full px-3 py-2 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Acad√©mie</label>
                                <input type="text" id="profile-academy" value="${appData.ianProfile.academy || ''}"
                                    onchange="updateProfile('academy', this.value)"
                                    class="w-full px-3 py-2 border rounded-lg">
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Objectifs</label>
                            <textarea id="profile-objectives" 
                                onchange="updateProfile('objectives', this.value)"
                                rows="3" class="w-full px-3 py-2 border rounded-lg">${appData.ianProfile.objectives || ''}</textarea>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadDirectoryContent() {
            const content = document.getElementById('directory-content');
            content.innerHTML = `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-2xl font-bold text-gray-800">Annuaire des IAN</h2>
                        <button onclick="addContact()" class="px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600">
                            ‚ûï Ajouter un contact
                        </button>
                    </div>
                    <div id="contacts-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${renderContacts()}
                    </div>
                </div>
            `;
        }

        function renderContacts() {
            if (appData.directoryProfiles.length === 0) {
                return '<p class="col-span-full text-center text-gray-500">Aucun contact dans l'annuaire</p>';
            }
            
            return appData.directoryProfiles.map((contact, index) => `
                <div class="contact-card bg-white rounded-lg shadow p-4 border-2">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-semibold text-lg">${contact.name}</h3>
                        <button onclick="deleteContact(${index})" class="text-red-500 hover:text-red-700">‚úï</button>
                    </div>
                    <p class="text-sm text-gray-600">${contact.discipline || 'Non renseign√©'}</p>
                    <p class="text-sm text-gray-600">${contact.etablissement || 'Non renseign√©'}</p>
                    <p class="text-sm text-blue-600">${contact.email || 'Non renseign√©'}</p>
                </div>
            `).join('');
        }

        function loadNewsletterContent() {
            const content = document.getElementById('newsletter-content');
            content.innerHTML = `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-gray-800">Newsletters</h2>
                    <p class="text-gray-600">G√©rez vos newsletters trimestrielles ici.</p>
                </div>
            `;
        }

        function loadUsagesContent() {
            const content = document.getElementById('usages-content');
            content.innerHTML = `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-gray-800">Usages du num√©rique</h2>
                    <p class="text-gray-600">Explorez les pratiques p√©dagogiques num√©riques.</p>
                </div>
            `;
        }

        // Fonctions de mise √† jour
        function updateProfile(field, value) {
            appData.ianProfile[field] = value;
            saveDataToGitHub();
        }

        function addContact() {
            const name = prompt('Nom du contact:');
            if (name) {
                const contact = {
                    name,
                    discipline: prompt('Discipline:') || '',
                    etablissement: prompt('√âtablissement:') || '',
                    email: prompt('Email:') || '',
                    dateCreation: new Date().toISOString()
                };
                appData.directoryProfiles.push(contact);
                saveDataToGitHub();
                loadDirectoryContent();
            }
        }

        function deleteContact(index) {
            if (confirm('Supprimer ce contact ?')) {
                appData.directoryProfiles.splice(index, 1);
                saveDataToGitHub();
                loadDirectoryContent();
            }
        }

        // V√©rification de l'authentification au chargement
        window.addEventListener('DOMContentLoaded', async () => {
            const { token, username } = githubService.getStoredCredentials();
            if (token && username) {
                const result = await githubService.verifyToken(token);
                if (result.valid) {
                    githubService.setCredentials(token, username);
                    
                    // Mettre √† jour l'interface utilisateur
                    document.getElementById('user-name').textContent = username;
                    if (result.user.avatar_url) {
                        const avatar = document.getElementById('user-avatar');
                        avatar.src = result.user.avatar_url;
                        avatar.style.display = 'block';
                    }
                    
                    // Charger les donn√©es
                    await loadDataFromGitHub();
                    
                    // Afficher l'application
                    document.getElementById('login-screen').classList.remove('active');
                    document.getElementById('main-app').style.display = 'block';
                } else {
                    githubService.clearCredentials();
                }
            }
        });
    </script>
</body>
</html>