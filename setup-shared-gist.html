<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IAN - Configuration du Gist Public</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-teal-900 via-emerald-800 to-teal-700 min-h-screen p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-2xl p-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-4">Configuration du Gist Public Partagé</h1>
        <p class="text-gray-600 mb-6">
            Ce script va créer un Gist public partagé qui servira d'annuaire pour tous les profils IAN.
        </p>

        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Token GitHub</label>
                <input type="password" id="github-token"
                    placeholder="ghp_..."
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500">
                <p class="text-xs text-gray-500 mt-1">Votre token avec le scope "gist"</p>
            </div>

            <button onclick="createSharedGist()"
                class="w-full bg-teal-600 text-white py-3 rounded-lg hover:bg-teal-700 font-medium">
                Créer le Gist Public Partagé
            </button>

            <div id="result" class="hidden mt-4 p-4 rounded-lg"></div>
        </div>

        <div class="mt-8 p-4 bg-blue-50 rounded-lg">
            <h2 class="font-bold text-blue-800 mb-2">Instructions</h2>
            <ol class="list-decimal list-inside text-sm text-blue-700 space-y-2">
                <li>Générez un token GitHub avec le scope "gist" sur <a href="https://github.com/settings/tokens" class="underline" target="_blank">GitHub Settings</a></li>
                <li>Collez votre token dans le champ ci-dessus</li>
                <li>Cliquez sur "Créer le Gist Public Partagé"</li>
                <li>Copiez l'ID du Gist généré</li>
                <li>Remplacez l'ID dans le fichier app.js (ligne ~11)</li>
            </ol>
        </div>
    </div>

    <script>
        async function createSharedGist() {
            const token = document.getElementById('github-token').value;
            const resultDiv = document.getElementById('result');

            if (!token) {
                resultDiv.className = 'block mt-4 p-4 rounded-lg bg-red-100 border border-red-300';
                resultDiv.innerHTML = '<p class="text-red-700">Veuillez entrer votre token GitHub</p>';
                return;
            }

            resultDiv.className = 'block mt-4 p-4 rounded-lg bg-yellow-100';
            resultDiv.innerHTML = '<p class="text-yellow-700">Création du Gist en cours...</p>';

            try {
                const response = await fetch('https://api.github.com/gists', {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        description: '[SHARED] IAN Profiles Directory - Annuaire Public des Interlocuteurs Académiques au Numérique',
                        public: true,
                        files: {
                            'ian-profiles.json': {
                                content: JSON.stringify({
                                    profiles: [],
                                    lastUpdated: new Date().toISOString(),
                                    description: 'Annuaire public des profils IAN'
                                }, null, 2)
                            },
                            'README.md': {
                                content: `# Annuaire Public des IAN

Ce Gist contient l'annuaire public de tous les Interlocuteurs Académiques au Numérique (IAN).

## Structure

Le fichier \`ian-profiles.json\` contient un tableau de profils avec les informations suivantes :

- \`username\`: Nom d'utilisateur GitHub
- \`name\`: Nom complet
- \`academy\`: Académie
- \`discipline\`: Discipline enseignée
- \`email\`: Email professionnel (optionnel)
- \`objectives\`: Objectifs et domaines d'intérêt
- \`lastUpdated\`: Date de dernière mise à jour

## Utilisation

Ce Gist est automatiquement mis à jour par l'application IAN lorsque les utilisateurs modifient leur profil.

**Note**: Ce Gist est public et les informations sont visibles par tous.
`
                            }
                        }
                    })
                });

                if (response.ok) {
                    const gist = await response.json();
                    resultDiv.className = 'block mt-4 p-4 rounded-lg bg-green-100 border border-green-300';
                    resultDiv.innerHTML = `
                        <p class="text-green-700 font-bold mb-2">✓ Gist créé avec succès!</p>
                        <p class="text-sm text-green-600 mb-2">ID du Gist:</p>
                        <input type="text" value="${gist.id}" readonly
                            class="w-full px-3 py-2 bg-white border border-green-300 rounded font-mono text-sm mb-2"
                            onclick="this.select()">
                        <p class="text-xs text-green-600 mb-2">Cliquez pour sélectionner et copier</p>
                        <p class="text-sm text-green-600">URL du Gist:</p>
                        <a href="${gist.html_url}" target="_blank"
                            class="text-blue-600 underline text-sm break-all">${gist.html_url}</a>
                        <div class="mt-4 p-3 bg-yellow-50 border border-yellow-300 rounded">
                            <p class="text-sm text-yellow-800 font-medium">Action requise:</p>
                            <p class="text-xs text-yellow-700 mt-1">
                                Remplacez la valeur de <code class="bg-gray-200 px-1 rounded">sharedGistId</code>
                                dans le fichier <code class="bg-gray-200 px-1 rounded">app.js</code> (ligne ~11)
                                par: <strong>${gist.id}</strong>
                            </p>
                        </div>
                    `;
                } else {
                    const error = await response.json();
                    resultDiv.className = 'block mt-4 p-4 rounded-lg bg-red-100 border border-red-300';
                    resultDiv.innerHTML = `<p class="text-red-700">Erreur: ${error.message || 'Impossible de créer le Gist'}</p>`;
                }
            } catch (error) {
                resultDiv.className = 'block mt-4 p-4 rounded-lg bg-red-100 border border-red-300';
                resultDiv.innerHTML = `<p class="text-red-700">Erreur: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
